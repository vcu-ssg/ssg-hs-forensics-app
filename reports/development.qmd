---
title: "Developer Documentation"
author: "SSG Forensics Team"
date: last-modified
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: false
---

## Overview

This guide is intended for developers and contributors interested in understanding the architecture and implementation details of the SSG High School Forensics Application. It provides insights into the project structure, technology stack, and key components.

::: {.callout-warning}
If you are looking for documentation on how to create lessons for the application, please see the [Creating New Lessons](lesson-creation-guide.qmd) guide instead.
:::

## Important Notes

::: {.callout-note}
**Image Folder Optimization**: The sample gallery images directory should ideally contain pre-processed images so that (1) users don't need to wait for initial processing and (2) user-processed images remain separate from sample images.
:::

For more detailed implementation information, developers should refer to code comments and docstrings located directly in the relevant source files.



## Project Structure

All file locations are relative to the root directory: `ssg-hs-forensics-app/`

### Frontend: `forensics-ui/`

This directory contains all files used to generate the application website and user interface.

| Directory/File | Purpose |
|---|---|
| `_site/` | Rendered HTML pages of the website (output from Quarto build) |
| `.quarto/` | Intermediate files generated by Quarto during the build process |
| `_quarto.yml` | Master configuration file that coordinates all frontend components and generates the navigation bar |
| `cell-gallery/` | Interactive cell image gallery; sends user selections to backend for processing |
| `lesson-1/`, `lesson-3/` | Lesson content files (QMD format) with associated stylesheets |
| `upload/` | Upload functionality for user-submitted microscope images |
| `styles.css` | Global styling for the application |

### Backend: `forensics-backend/`

This directory manages image processing and server functionality.

```
forensics-backend/
├── app/
│   ├── Dockerfile           # Docker image configuration
│   ├── main.py              # FastAPI server with image processing endpoints
│   ├── requirements.txt      # Python dependencies
│   ├── run_sam2.py          # SAM2 model execution
│   └── runsam.py            # Legacy SAM model execution
├── nginx/
│   └── default.conf         # NGINX reverse proxy configuration
└── docker-compose.yml       # Docker multi-container orchestration
```

**Key Components:**

- **`main.py`**: Contains FastAPI endpoints for image processing and retrieval
- **`run_sam2.py`**: Handles image segmentation and analysis using the SAM2 model
- **`docker-compose.yml`**: Orchestrates FastAPI and NGINX containers
- **`default.conf`**: Routes requests between frontend and backend services

### Image Storage: `images/`

Images are organized by processing state:

```
images/
├── sample-gallery-images/   # Pre-loaded reference images (organized by cell type)
│   ├── buccal_cells/
│   ├── epidermal_cells/
│   └── saliva_cells/
├── uploaded-images/         # User-submitted images
└── processed-images/        # Results from SAM model processing
```

### Documentation: `reports/`

Contains Quarto markdown files that generate developer and user documentation.

| File | Purpose |
|---|---|
| `development.qmd` | This file; developer-focused documentation |
| `lesson-creation-guide.qmd` | Guide for educators creating new lessons |
| `image-gallery-guide.qmd` | User guide for the image gallery and upload features |



## Technology Stack

This project utilizes a modern, modular architecture with clear separation between frontend and backend components.

### Frontend Technologies

- **Quarto**: Generates static HTML pages from markdown (QMD) files
- **HTML/CSS**: Structure and styling of user interface
- **JavaScript**: Client-side interactivity and API communication

### Backend Technologies

- **Python**: Core processing logic and server implementation
- **FastAPI**: RESTful API framework for image processing endpoints
- **SAM2 Model**: AI-powered image segmentation for cell identification
- **Docker & NGINX**: Container orchestration and reverse proxy configuration

### Processing Pipeline

The image processing workflow follows this architecture:

```
User Browser
    ↓
Frontend (JavaScript/HTML)
    ↓
NGINX Reverse Proxy
    ↓
FastAPI Backend (main.py)
    ↓
SAM2 Model (run_sam2.py)
    ↓
File System (processed-images/)
    ↓
Results returned to Frontend
```

## Key Architectural Patterns

### Frontend-Backend Communication

The frontend communicates with the backend through HTTP requests:

- **Upload images**: POST to `/api/process-img`
- **Retrieve images**: GET from `/api/gallery/` endpoints
- **Status queries**: GET requests for processing status

### Image Processing Workflow

1. User selects or uploads an image
2. Frontend encodes image as blob and sends to backend
3. Backend receives image and queues for SAM2 processing
4. SAM2 model generates cell segmentation masks
5. Processed image is saved to disk
6. Response sent back to frontend
7. Gallery automatically refreshes

### Container Architecture

The Docker Compose setup creates isolated, interconnected containers:

- **FastAPI Container**: Runs the Python application server
- **NGINX Container**: Acts as reverse proxy and load balancer
- **Volume Mounts**: Allow containers to access shared image directories

## Development Best Practices

### Code Organization

When adding new features, follow these patterns:

- **Backend endpoints**: Define in `forensics-backend/app/main.py`
- **Frontend logic**: Add to lesson/gallery QMD files as JavaScript code blocks
- **Shared utilities**: Consider adding to dedicated modules rather than inline code
- **Configuration**: Use environment variables and config files rather than hardcoding values

### Debugging and Logging

- Backend logs are available through Docker: `docker compose logs -f app`
- Frontend errors appear in browser console (F12)
- Add print statements or logging in Python for backend diagnostics

### Testing Considerations

- Test image processing with various image formats and sizes
- Verify NGINX routing between containers
- Test frontend-backend communication with different network conditions

## Building and Deployment

To set up the development environment:

```bash
# Install dependencies
make install

# Start the application
make run

# Build documentation
make docs
```

Refer to the `Makefile` and `README.md` for complete build instructions and advanced deployment options.