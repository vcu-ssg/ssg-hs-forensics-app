---
title: "Identify all Blood Cells"
format:
  html:
    css: styles.css
    page-layout: full
---

<div class="shell" style="display:grid;place-items:center;min-height:100vh;background:#f3f4f6;">
  <main class="card" style="background:white;padding:2rem 3rem;border-radius:1rem;box-shadow:0 10px 20px rgba(0,0,0,.05);text-align:center;width:min(800px,90%);">
    <h2 style="font-weight:700;margin-bottom:1.5rem;">Identify all blood cells</h2>

<!-- Image Grid -->
<form id="blood-form">
  <div class="grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem;">

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/bucCell1.png" hidden>
    <img src="assets/bucCell1.png" alt="blood cell 1">
  </label>

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/saliva4.png" hidden>
    <img src="assets/saliva4.png" alt="blood cell 2">
  </label>

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/saliva2.png" hidden>
    <img src="assets/saliva2.png" alt="blood cell 3">
  </label>

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/bucCell5.png" hidden>
    <img src="assets/bucCell5.png" alt="blood cell 4">
  </label>

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/saliva3.png" hidden>
    <img src="assets/saliva3.png" alt="blood cell 5">
  </label>

  <label class="img-choice">
    <input type="checkbox" name="cell" value="assets/bucCell4.png" hidden>
    <img src="assets/bucCell4.png" alt="blood cell 6">
  </label>

  </div>

  <!-- Submit button -->
  <button type="submit" class="btn" style="background:#d1d5db;color:#000;padding:.6rem 2rem;border-radius:2rem;border:none;cursor:pointer;font-weight:600;">Submit</button>

</form>

  </main>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  function addLesson3Score(score, total) {
    const s = Number(localStorage.getItem('lesson3Score') || 0);
    const t = Number(localStorage.getItem('lesson3Total') || 0);
    localStorage.setItem('lesson3Score', s + score);
    localStorage.setItem('lesson3Total', t + total);
  }

  const form = document.getElementById('blood-form');
  if (!form) return;

  const choices = form.querySelectorAll('.img-choice');

  // ✅ Correct images for this page
  const correct = new Set([
    "assets/saliva2.png",
    "assets/bucCell5.png",
    "assets/saliva3.png",
  ]);

  // Allow clicking the image to toggle the checkbox
  choices.forEach(choice => {
    choice.addEventListener('click', () => {
      const input = choice.querySelector('input[name="cell"]');
      if (!input) return;
      input.checked = !input.checked;
      choice.classList.toggle('selected', input.checked);
    });
  });

  let reviewed = false; // first submit = review, second = go next

  form.addEventListener('submit', e => {
    e.preventDefault();

    // SECOND SUBMIT → go to next page
    if (reviewed) {
      window.location.href = 'skin.html';
      return;
    }

    // FIRST SUBMIT → score + review mode
    const inputs = [...form.querySelectorAll('input[name="cell"]')];
    const selectedValues = inputs.filter(i => i.checked).map(i => i.value);

    if (selectedValues.length === 0) {
      alert('Please select at least one blood cell image.');
      return;
    }

    // Remove any old classes
    choices.forEach(choice => {
      choice.classList.remove('correct', 'incorrect');
    });

    // Score this page
    const scoreThisPage = selectedValues.filter(v => correct.has(v)).length;
    const totalThisPage = correct.size;
    addLesson3Score(scoreThisPage, totalThisPage);

    // Highlight ALL correct images in green
    choices.forEach(choice => {
      const input = choice.querySelector('input[name="cell"]');
      if (!input) return;
      if (correct.has(input.value)) {
        choice.classList.add('correct');
      }
    });

    // Highlight incorrect selections in red
    choices.forEach(choice => {
      const input = choice.querySelector('input[name="cell"]');
      if (!input) return;
      if (input.checked && !correct.has(input.value)) {
        choice.classList.add('incorrect');
      }
    });

    // Page feedback
    let feedback = document.getElementById('page-feedback');
    if (!feedback) {
      feedback = document.createElement('p');
      feedback.id = 'page-feedback';
      feedback.style.marginTop = '1rem';
      feedback.style.fontWeight = '500';
      form.appendChild(feedback);
    }
    feedback.textContent = `You selected ${scoreThisPage} of ${totalThisPage} correct images on this page.`;

    // Legend
    let legend = document.getElementById('page-legend');
    if (!legend) {
      legend = document.createElement('div');
      legend.id = 'page-legend';
      legend.style.marginTop = '0.75rem';
      legend.innerHTML = `
        ✅ <strong>Green border</strong>: correct cell type<br>
        ❌ <strong>Red border</strong>: not this cell type
      `;
      form.appendChild(legend);
    }

    // Change button text to "Next"
    const submitBtn = form.querySelector('button[type="submit"]');
    if (submitBtn) submitBtn.textContent = 'Next';

    reviewed = true; // next submit sends them forward
  });
});
</script>



